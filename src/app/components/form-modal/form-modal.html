<div class="modal fade" [class.show]="isOpen" [style.display]="isOpen ? 'block' : 'none'" tabindex="-1" role="dialog"
  [attr.aria-hidden]="!isOpen" (click)="onBackdropClick()">
  <div class="modal-dialog {{ getModalSizeClass() }}" role="document" (click)="$event.stopPropagation()">
    <div class="modal-content">

      <!-- Header -->
      <div class="modal-header">
        <h5 class="modal-title">{{ title }}</h5>
        <button type="button" class="btn-close" (click)="onClose()" [disabled]="isSaving" aria-label="Close"></button>
      </div>

      <!-- Body -->
      <div class="modal-body">
        <form #form="ngForm">
          <div class="row g-3">
            <div *ngFor="let field of fields" [ngClass]="getColClass(field)">
              <label [for]="field.key" class="form-label">
                {{ field.label }}
                <span *ngIf="field.required" class="text-danger">*</span>
              </label>

              <!-- Text/Number/Email/Date/Password Input -->
              <input
                *ngIf="['text', 'number', 'email', 'datetime', 'date', 'password'].includes(field.type)"
                [type]="field.type"
                class="form-control"
                [id]="field.key"
                [name]="field.key"
                [(ngModel)]="formData[field.key]"
                [required]="field.required ?? false"
                [disabled]="field.disabled || isSaving"
                [placeholder]="field.placeholder || ''" />

              <!-- Textarea -->
              <textarea
                *ngIf="field.type === 'textarea'"
                class="form-control"
                [id]="field.key"
                [name]="field.key"
                [(ngModel)]="formData[field.key]"
                [required]="field.required ?? false"
                [disabled]="field.disabled || isSaving"
                [placeholder]="field.placeholder || ''"
                [rows]="field.rows || 3">
              </textarea>

              <!-- Select -->
              <select
                *ngIf="field.type === 'select'"
                class="form-select"
                [id]="field.key"
                [name]="field.key"
                [(ngModel)]="formData[field.key]"
                [required]="field.required ?? false"
                [disabled]="field.disabled || isSaving">
                <option value="">-- Chọn {{ field.label }} --</option>
                <option *ngFor="let opt of field.options" [value]="opt.value">
                  {{ opt.label }}
                </option>
              </select>
            </div>
          </div>

          <!-- Error Message -->
          <div *ngIf="errorMessage" class="alert alert-danger mt-3" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            {{ errorMessage }}
          </div>
        </form>
      </div>

      <!-- Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="onClose()" [disabled]="isSaving">
          Hủy
        </button>
        <button type="button" class="btn btn-primary" (click)="onSubmit(form)" [disabled]="isSaving || form.invalid">
          {{ submitButtonText }}
        </button>
      </div>

    </div>
  </div>
</div>

<!-- Backdrop -->
<div class="modal-backdrop fade" [class.show]="isOpen" *ngIf="isOpen" (click)="onBackdropClick()">
</div>
